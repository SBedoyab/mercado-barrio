CREATE DATABASE IF NOT EXISTS MercadoBarrio CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
USE MercadoBarrio;
CREATE TABLE IF NOT EXISTS products ( id INT AUTO_INCREMENT PRIMARY KEY, sku VARCHAR(50) NOT NULL UNIQUE, name VARCHAR(100) NOT NULL, weight_grams INT NOT NULL DEFAULT 0, fragile TINYINT(1) NOT NULL DEFAULT 0 );
CREATE TABLE IF NOT EXISTS orders ( id INT AUTO_INCREMENT PRIMARY KEY, customer_email VARCHAR(120) NOT NULL, address VARCHAR(200) NOT NULL, priority ENUM('normal','express') NOT NULL DEFAULT 'normal', fragility ENUM('ninguna','debil','alta') NOT NULL DEFAULT 'ninguna', total_weight INT NOT NULL DEFAULT 0, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP );
CREATE TABLE IF NOT EXISTS order_items ( id INT AUTO_INCREMENT PRIMARY KEY, order_id INT NOT NULL, product_id INT NOT NULL, quantity INT NOT NULL, FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE, FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE RESTRICT );
CREATE TABLE IF NOT EXISTS shipments ( id INT AUTO_INCREMENT PRIMARY KEY, order_id INT NOT NULL, provider VARCHAR(30) NOT NULL, tracking_id VARCHAR(60) NOT NULL, status ENUM('CONFIRMADO','DESPACHADO','EN_RUTA','ENTREGADO') NOT NULL DEFAULT 'CONFIRMADO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE );
CREATE TABLE IF NOT EXISTS notifications ( id INT AUTO_INCREMENT PRIMARY KEY, order_id INT NOT NULL, channel VARCHAR(20) NOT NULL, message VARCHAR(255) NOT NULL, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE );
